import { NextResponse } from 'next/server'; import { Store } from '../../../../../shared/store'; export async function GET(){ const rows=[['sessionId','jobId','jobTitle','company','startedAt','endedAt','outcome','notes','email']]; for(const s of Store.sessions){ const j=Store.getJob(s.jobId); const q=Store.queue.find(q=>q.sessionId===s.sessionId) || { email:'' }; rows.push([s.sessionId,s.jobId,j?.title||'',j?.company||'',String(s.startedAt||''),String(s.endedAt||''),s.outcome||'',s.notes||'',(q as any).email||'']); } const body=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n'); return new NextResponse(body, { headers: { 'Content-Type':'text/csv', 'Content-Disposition':'attachment; filename="outcomes.csv"' } }); }
